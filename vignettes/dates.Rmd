---
title: "Dates"
author: "Imanuel Costigan"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    theme: spacelab
vignette: >
  %\VignetteIndexEntry{Dates}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  error = FALSE,
  tidy = FALSE)
```

Over-the-counter (OTC) derivatives comprise a significant proportion of trading activity in global financial markets. Their general contractual conventions are specified in what are known as International Swap and Derivatives Association (ISDA) definitions. For example, FX and currency option transactions are governed by the *1998 FX and Currency Options Definitions* and swap transactions are governed by the *2006 ISDA Definitions*. They describe in meticulous detail, among other things, how the dates of certain financial events should be determined. This includes how dates are defined to be good or bad and how bad dates are to be adjusted to good dates.

## Calendars

The `Calendar` class is extended by and provides the interface for city specific
calendar classes (e.g. `USNYCalendar`). The generator objects for these city 
calendars have a name prefixed by four upper case letters: the first two being a 
country code (e.g. `US`) and the latter two being a city code (e.g. `NY`). 
Supported calendars are documented in `?Calendar`.

The interface contains three key methods: `is_good`, `adjust` and `shift`. These
are described below.

## Good day functions

The `is_good()` method to the `Calendar` class determines whether a date or vector of dates is a business day in a given locale (i.e. city). Some examples of its use are:

```{r is_good}
library("lubridate")
library("fmdates")
# ausy <- AUSYCalendar$new()
# aume <- AUMECalendar$new()
# syme <- JointCalendar$new(list(ausy, aume), all)
# ausy$is_good(ymd(20140404))
# syme$is_good(ymd(20141104)) # Melbourne Cup holiday
# syme$rule <- any
# syme$is_good(ymd(20141104))
```

## Bad day adjusters

There are a number of different ways to adjust a bad day to a good day using the `adjust()` method of the `Calendar` class. Some examples include:

```{r adjust_dates}
# ausy$adjust(ymd(20140404), 'mf')
# ausy$adjust(ymd(20141130), 'mf')
# ausy$adjust(ymd(20141101), 'mp')
# ausy$adjust(ymd(20141115), 'ms')
```

## Shifters

Occasionally it is necessary to shift a date by a certain period or to a certain epoch. The can be done by using the `shift()` method of the `Calendar` class. 

```{r shift_dates}
# ausy$shift(ymd(20120229), days(2), 'u', FALSE) # two good days
# ausy$shift(ymd(20120229), months(1), 'u', FALSE) # one month
# ausy$shift(ymd(20120229), months(1), 'mf', TRUE)  # one month with EOM rule
# ausy$shift(ymd(20120229), years(1) + months(3), 'mf', TRUE)  # 1y3m
# ausy$shift(ymd(20120229), hours(1), 'mf', TRUE)  # periods < days ignored. 
```

## Day count fractions

It is possible to determine the length of a period. This known as the day count fraction, year fraction or day count. The package has implemented a number of common day counters (see `?year_frac`).

```{r day_counters}
year_frac(ymd("2010-03-31"), ymd("2012-03-31"), "30/360us")
year_frac(ymd("2010-02-28"), ymd("2012-03-31"), "act/365")
```
